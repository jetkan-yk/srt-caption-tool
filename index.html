<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>SRT Caption Tool</title>
    <style>
      body {
        text-align: center;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue",
          sans-serif;
      }

      .container {
        display: flex;
        gap: 20px;
        max-width: 1200px;
        height: 70vh;
        margin: 0 auto;
      }

      .column {
        display: flex;
        flex: 1;
        flex-direction: column;
      }

      textarea {
        height: 100%;
        margin-bottom: 10px;
        resize: none;
        font-size: large;
      }

      button {
        font-size: xx-large;
      }
    </style>
  </head>
  <body>
    <h1>SRT Caption Tool</h1>
    <div class="container">
      <div class="column">
        <h2>SRT Content</h2>
        <textarea
          id="srtInput"
          rows="15"
          placeholder="Paste SRT content here..."
        ></textarea>
        <button onclick="extractCaptions()">Extract Captions</button>
      </div>
      <div class="column">
        <h2>Captions</h2>
        <textarea
          id="captionText"
          rows="15"
          placeholder="Extracted captions will appear here..."
        ></textarea>
        <button id="replaceUndoButton" onclick="toggleReplaceUndo()">
          Replace Captions
        </button>
      </div>
    </div>

    <script>
      let originalSrtContent = ""; // Store the original SRT content

      // Extract every 4th line starting with the 3rd (index 2) from the SRT input.
      function extractCaptions() {
        const srtContent = document.getElementById("srtInput").value;
        const lines = srtContent.split(/\r?\n/);
        const extracted = [];
        // Assuming SRT blocks: index, timecode, caption, blank
        for (let i = 2; i < lines.length; i += 4) {
          extracted.push(lines[i]);
        }
        document.getElementById("captionText").value = extracted.join("\n\n");

        // Reset the button to "Replace Captions"
        document.getElementById("replaceUndoButton").textContent =
          "Replace Captions";
      }

      function toggleReplaceUndo() {
        const button = document.getElementById("replaceUndoButton");
        const srtInput = document.getElementById("srtInput");

        if (button.textContent === "Replace Captions") {
          // Save the original content and replace captions
          originalSrtContent = srtInput.value;
          replaceCaptions();
          button.textContent = "Undo";
        } else {
          // Restore the original content
          srtInput.value = originalSrtContent;
          button.textContent = "Replace Captions";
        }
      }

      function replaceCaptions() {
        const srtContent = document.getElementById("srtInput").value;
        let srtLines = srtContent.split(/\r?\n/);
        const newCaptions = document
          .getElementById("captionText")
          .value.split(/\r?\n/)
          .filter((line) => line.trim() !== "");

        const replacedLines = [];
        // Process existing SRT blocks (assumed groups of 4 lines)
        let blockCount = Math.floor(srtLines.length / 4);
        for (let b = 0; b < blockCount; b++) {
          let start = b * 4;
          replacedLines.push(srtLines[start]); // index
          replacedLines.push(srtLines[start + 1]); // time range
          // Replace caption line: use new caption if available, otherwise "-"
          if (b < newCaptions.length) {
            replacedLines.push(newCaptions[b]);
          } else {
            replacedLines.push("-");
          }
          // Preserve the blank separator line if present
          replacedLines.push(
            srtLines[start + 3] !== undefined ? srtLines[start + 3] : ""
          );
        }

        // Append extra new captions as new SRT blocks if any
        if (newCaptions.length > blockCount) {
          for (let i = blockCount; i < newCaptions.length; i++) {
            replacedLines.push(newCaptions[i]);
            replacedLines.push("");
          }
        }

        // Update the SRT input box with the replaced content
        document.getElementById("srtInput").value = replacedLines.join("\n");
      }
    </script>
  </body>
</html>
